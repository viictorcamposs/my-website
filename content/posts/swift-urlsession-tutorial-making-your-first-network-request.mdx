---
  type: Post
  title: 'Swift URLSession Tutorial: Making Your First Network Request'
  description: Learn Swift network requests with URLSession, from setup to response handling, and start building powerful iOS apps today!
  releaseDate: 2023-10-17
  keywords: 
    - Swift
    - Mobile
    - Software
    - Guide
    - Tutorial
  hero:
    author: 
      name: Pelly Benassi
      unsplash:
        account: '@solidpixel'
        image: Hz1WQbHcXag
---

I'm currently learning how to build iOS apps in Swift. A few days ago I [built my first project][myGithubProject]
using an external API to serve the data for my app. Since this is a pretty basic task to perform when working
in software development, I decided to write this tutorial article teaching how to make a simple network
request in Swift using the URLSession object and maybe **help someone in the future** (probably myself).

{/* For this article I'm supposing you have a basic understand in Swift language and API. If you don't */}
{/* know what an API is, I recommend you to read this article: [What is an API? In English, please.][WhatIsAnAPI] */}

### URLSession

URLSession is an API that Swift provides us for handling network requests, like fetch and return
data to our app, download files, or upload data and files to remote locations. It's a very powerful tool
and we can do tons of things with it, but for now we'll keep it simple.

Let's use the project I mentioned as an example. We're building an app that'll show the latest
Bitcoin prices in different currencies. To make it happen, we need to grab the data from the [CoinAPI][CoinAPI]
and we'll use the URLSession, following four simple steps:

- **Step 1:** Create a URL
- **Step 2:** Create a URLSession
- **Step 3:** Give URLSession a task
- **Step 4:** Start the task

{/* Note: if they don't have a project to follow along, they can create a new playground in XCode */}

### Setting Up

#### Step 1: Create a URL

When creating an instance of the URL structure you will see that you can call the same method with
different parameters. In our case, we'll initialize our URL instance with just the _string_ param.

```swift showLineNumbers /URL(string: urlString)/
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {

}
```

- Because URL() has an optional type, we use a [optional binding][optionalBinding] with the **if let
  statement** to safely unwrap and access the value returned from the URL instance

#### Step 2: Create a URLSession

In the next step we create and configure a session for our network request.

```swift showLineNumbers {4}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)
}
```

There are three types of URL sessions that we can use:

- [**Default:**][urlDefaultSession] used for basic requests and suitable for most common use cases
- [**Ephemeral:**][urlEphemeralSession] ideal for situations where you need privacy
- [**Background:**][urlBackgroundSession] allows you to download or upload data in the background, like
  when you suspend an app on your iOS device

### Making GET Request

#### Step 3: Give URLSession a task

Now that we have a session for our network request, we need to give a task for it. There are three
main types of tasks we can use with URLSession:

- **Data tasks:** send and receive data; intended for short, often interactive requests
- **Download tasks:** for scenarios where you want to download large files, and saved them to the device's storage
- **Upload tasks:** typically used in scenarios like sending user-generated content or files to a server

{/* Note: Swift provides for us a shared session with a good default configuration for most tasks and suitable */}
{/* for most common use cases. We could've used it in our case, but for learning purposes I've opted */}
{/* for creating an instance with a configuration parameters. */}

**Implementing a data task for our session:**

```swift showLineNumbers {6-8}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)

  let task = session.dataTask(with: url) { (data, response, error) in

  }
}
```

- We use the _"dataTask(with: URL, completionHandler:)"_ method, implementing the _"completionHandler:"_
  function with a [closure][swiftClosure]

#### Step 4: Start the task

The task we added to our session initially has a suspended state, which means that it's waiting
for us to start it. We do this by calling its _"resume()"_ method.

```swift showLineNumbers {10}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)

  let task = session.dataTask(with: url) { (data, response, error) in

  }

  task.resume()
}
```

And, once we've done starting the task, we're able to continue and handle the response.

### Handling response

When we print the data returned from the _"dataTask()"_ method, we won't be able to see the contents
of the data.

```swift showLineNumbers {10-11}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)

  let task = session.dataTask(with: url) { (data, response, error) in
    // data has an optional type: Data?
    // again, we use optional binding to unwrap it
    if let safeData = data {
      print("raw data: ", safeData)
      // raw data: 138 bytes
    }
  }

  task.resume()
}
```

Although we know the data is in a JSON format (because our API's doc told us), that's not what we get.
So, what should we do?

#### Parsing data in JSON format

{/* We need to format this raw data, and then we'll be able to read and use it. */}
To fix this, we need to parse this data and turn it into an actual Swift object with properties and methods.

**Create a Struct with the expected JSON properties**

```swift showLineNumbers /Decodable/
struct CoinData: Decodable {
  let rate: Double
  let asset_id_quote: String
}
```

- We add the _Decodable_ typealias to let Swift know that our Struct can convert itself
  from an external representation, which means that we'll be able to read our data in JSON format

**Parse JSON with the native JSONDecoder**

```swift showLineNumbers {8-17}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)

  let task = session.dataTask(with: url) { (data, response, error) in
    if let safeData = data {
      do {
        let decoder = JSONDecoder()

        let decodedData = try decoder.decode(
          CoinData.self, // reference the type object
          from: safeData
        )
      } catch {

      }
    }
  }

  task.resume()
}
```

- the _decode_ method (11) can **throw an error**, so we need to add the _try_ word
- because we're using the _try_ word, we need to wrap it inside a **do block**
- then, we add the **catch block** to handle any potential errors properly

**Access properties from API JSON response**

Now, if we try to access the _decodedData_ constant, we'll be able to get the _rate_ and _asset_id_quote_
properties we extracted from the API JSON response.

```swift showLineNumbers {16-20}
let urlString = "https://rest.coinapi.io/v1/exchangerate/BTC/BRL"

if let url = URL(string: urlString) {
  let session = URLSession(configuration: .default)

  let task = session.dataTask(with: url) { (data, response, error) in
    if let safeData = data {
      do {
        let decoder = JSONDecoder()

        let decodedData = try decoder.decode(
          CoinData.self, // reference the type object
          from: safeData
        )

        print(decodedData)
        // CoinData(
        //  rate: 140113.1208321098,
        //  asset_id_quote: "BRL"
        // )
      } catch {

      }
    }
  }

  task.resume()
}
```

### Conclusion

That's it! Hopefully, you did your first network request. Congratulations!!! If you have any questions or
need clarification, feel free to reach me on Twitter or LinkedIn, and we can chat about it.
Now, as a challenge, I encourage you to read Apple's documentation and learn more about the subject.
I provided you with a lot of links from the Doc, so have at it. See you next time and great work! üôãüèª‚Äç‚ôÇÔ∏è

[myGithubProject]: https://github.com/viictorcamposs/bytecoin-app
[WhatIsAnAPI]: https://www.freecodecamp.org/news/what-is-an-api-in-english-please-b880a3214a82/
[CoinAPI]: https://www.coinapi.io/
[optionalBinding]: https://www.google.com/search?q=optional+binding+swift
[urlSharedSession]: https://developer.apple.com/documentation/foundation/urlsession/1409000-shared
[urlDefaultSession]: https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1411560-default
[urlEphemeralSession]: https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1410529-ephemeral
[urlBackgroundSession]: https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1407496-background
[swiftClosure]: https://docs.swift.org/swift-book/documentation/the-swift-programming-language/closures/
